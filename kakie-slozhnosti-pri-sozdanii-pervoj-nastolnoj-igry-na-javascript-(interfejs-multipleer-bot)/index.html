<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.a92dc125d7c04d396677.css">.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#546a90}.token.punctuation{color:#77749c}.namespace{opacity:.7}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#f6416c}.token.boolean,.token.number{color:#ffd400}.token.attr-name,.token.char,.token.inserted,.token.selector,.token.string{color:#7984d1}.token.builtin{color:#df85ff}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.function{color:#ff7a60}.token.class-name{color:#a875ff}.token.keyword{color:#fdbed4}.token.important,.token.regex{color:#ffb86c}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><meta name="generator" content="Gatsby 2.21.22"/><title data-react-helmet="true">Какие сложности при создании первой настольной игры на JavaScript (интерфейс, мультиплеер, бот)</title><link data-react-helmet="true" rel="webmention" href="https://webmention.io/lehasvv2009.netlify.app//webmention"/><link data-react-helmet="true" rel="pingback" href="https://webmention.io/lehasvv2009.netlify.app//xmlrpc"/><link data-react-helmet="true" rel="canonical" href="https://medium.com/@lehasvv2009/how-to-create-first-boardgame-with-javascript-ui-online-bot-4b5db6c72b75"/><meta data-react-helmet="true" charSet="utf-8"/><meta data-react-helmet="true" http-equiv="X-UA-Compatible" content="IE=edge"/><meta data-react-helmet="true" name="viewport" content="width=device-width, initial-scale=1"/><meta data-react-helmet="true" name="theme-color" content="#fff"/><meta data-react-helmet="true" itemProp="name" content="Какие сложности при создании первой настольной игры на JavaScript (интерфейс, мультиплеер, бот)"/><meta data-react-helmet="true" name="description" content="Статья может быть интересна разработчикам, у которых есть опыт с JavaScript и React, но нет опыта в разработке игр."/><meta data-react-helmet="true" itemProp="image" content="https://lehasvv2009.netlify.app/static/77b699ee4748cd19e9d9c97057b6dbfb/48094/avatar.png"/><meta data-react-helmet="true" property="og:title" content="Какие сложности при создании первой настольной игры на JavaScript (интерфейс, мультиплеер, бот)"/><meta data-react-helmet="true" property="og:description" content="Статья может быть интересна разработчикам, у которых есть опыт с JavaScript и React, но нет опыта в разработке игр."/><meta data-react-helmet="true" property="og:image" content="https://lehasvv2009.netlify.app/static/77b699ee4748cd19e9d9c97057b6dbfb/48094/avatar.png"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content=""/><meta data-react-helmet="true" name="twitter:site" content=""/><meta data-react-helmet="true" name="twitter:title" content="Какие сложности при создании первой настольной игры на JavaScript (интерфейс, мультиплеер, бот)"/><meta data-react-helmet="true" name="twitter:description" content="Статья может быть интересна разработчикам, у которых есть опыт с JavaScript и React, но нет опыта в разработке игр."/><meta data-react-helmet="true" name="twitter:image" content="https://lehasvv2009.netlify.app/static/77b699ee4748cd19e9d9c97057b6dbfb/48094/avatar.png"/><meta data-react-helmet="true" name="twitter:label1" content="Reading time"/><meta data-react-helmet="true" name="twitter:data1" content="11 min read"/><link rel="icon" href="/favicon-32x32.png?v=c180c5fe4a00770520d60e7bcd71e8d2"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#ffffff"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=c180c5fe4a00770520d60e7bcd71e8d2"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=c180c5fe4a00770520d60e7bcd71e8d2"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=c180c5fe4a00770520d60e7bcd71e8d2"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=c180c5fe4a00770520d60e7bcd71e8d2"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=c180c5fe4a00770520d60e7bcd71e8d2"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=c180c5fe4a00770520d60e7bcd71e8d2"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=c180c5fe4a00770520d60e7bcd71e8d2"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=c180c5fe4a00770520d60e7bcd71e8d2"/><link rel="alternate" type="application/rss+xml" title="Alex Soroka" href="/rss.xml"/><link as="script" rel="preload" href="/webpack-runtime-41b2cfaf8224fefc2537.js"/><link as="script" rel="preload" href="/framework-20ef01989315425214b5.js"/><link as="script" rel="preload" href="/styles-87377f8a4e3d033dcfd3.js"/><link as="script" rel="preload" href="/532a2f07-9b9ff0c8c1058b049d2c.js"/><link as="script" rel="preload" href="/app-63ab9aa4b3aa6888c4ca.js"/><link as="script" rel="preload" href="/e55b1624863f201557be7973b640ebc2d41868d9-cf9bb96bd1d6c958c6af.js"/><link as="script" rel="preload" href="/component---node-modules-gatsby-theme-medium-to-own-blog-src-templates-blog-post-js-46f160a3f5c670133d66.js"/><link as="fetch" rel="preload" href="/page-data/kakie-slozhnosti-pri-sozdanii-pervoj-nastolnoj-igry-na-javascript-(interfejs-multipleer-bot)/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><main><style data-emotion-css="92yktz">body,html{margin:0;padding:0;}html{box-sizing:border-box;font-size:62.5%;background:#ffffff;}body{margin:0;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;line-height:1.6;font-size:2.1rem;font-weight:400;font-family:-apple-system,BlinkMacSystemFont,Avenir,'Avenir Next','Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,'Fira Sans','Droid Sans','Helvetica Neue',sans-serif;height:100%;background:#ffffff;color:rgba(0,0,0,0.84);text-rendering:optimizeLegibility;}h1,h2,p,i,a{color:rgba(0,0,0,0.84);}h1,h2,h3,h4,h5,h6{line-height:1.1;}h1{font-size:48px;text-align:left;margin-bottom:8px;}h2{font-size:26px;font-weight:700;padding:0;margin:56px 0 -13px -1.883px;text-align:left;line-height:34.5px;-webkit-letter-spacing:-0.45px;-moz-letter-spacing:-0.45px;-ms-letter-spacing:-0.45px;letter-spacing:-0.45px;}p,i,a{margin-top:21px;font-size:21px;-webkit-letter-spacing:-0.03px;-moz-letter-spacing:-0.03px;-ms-letter-spacing:-0.03px;letter-spacing:-0.03px;line-height:1.58;}a{-webkit-text-decoration:underline;text-decoration:underline;}blockquote{font-size:30px;font-style:italic;-webkit-letter-spacing:-0.36px;-moz-letter-spacing:-0.36px;-ms-letter-spacing:-0.36px;letter-spacing:-0.36px;line-height:44.4px;overflow-wrap:break-word;margin:55px 0 33px 0;color:rgba(0,0,0,0.68);border-left:3px solid rgba(0,0,0,0.84);padding-left:20px;margin-left:-23px;padding-bottom:2px;}blockquote p:last-child{margin-bottom:0;}pre,code{font-size:16px;background:rgb(243,243,243);font-family:'SFMono-Regular',Menlo,Monaco,'Courier New',Courier,monospace;}code{padding:3px 4px;margin:0 2px;}pre{overflow-x:auto;padding:20px;}pre code{padding:0;margin:0;}mark{background:lavender;}::selection{background-color:lavender;}img{max-width:100%;}h1,h2,h3,h4,h5,h6{position:relative;}.anchor{position:absolute;left:-30px;opacity:0;width:30px;}h1:hover .anchor,h2:hover .anchor,h3:hover .anchor,h4:hover .anchor,h5:hover .anchor,h6:hover .anchor{opacity:1;}h1 .anchor{margin-top:21px;}h3 .anchor{margin-top:5px;}h4 .anchor{margin-top:2px;}figcaption{width:100%;margin-top:10px;line-height:1.4;color:rgba(0,0,0,0.68);-webkit-letter-spacing:0;-moz-letter-spacing:0;-ms-letter-spacing:0;letter-spacing:0;text-align:center;font-size:14px;}</style><style data-emotion-css="1eyi4r2">.css-1eyi4r2{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}</style><section class="css-1eyi4r2"><style data-emotion-css="bqa0gu">.css-bqa0gu{max-width:700px;margin:0 auto;width:80%;}</style><div class="css-bqa0gu"><article><style data-emotion-css="d0rs0v">.css-d0rs0v{margin-top:5em;margin-bottom:2em;}.css-d0rs0v p{font-size:0.75em;}</style><header class="css-d0rs0v"><h1><style data-emotion-css="w2ty31">.css-w2ty31{-webkit-text-decoration:none;text-decoration:none;font-size:48px;color:lavender;margin-left:-40px;}</style><a class="css-w2ty31" href="/">«</a> <!-- -->Какие сложности при создании первой настольной игры на JavaScript (интерфейс, мультиплеер, бот)</h1><p>May 13, 2019<!-- --> • ☕️☕️ 11 min read</p><div></div></header><h4 id="какие-сложности-при-создании-первой-настольной-игры-на-javascript-интерфейс-мультиплеер-бот" style="position:relative"><a href="#%D0%BA%D0%B0%D0%BA%D0%B8%D0%B5-%D1%81%D0%BB%D0%BE%D0%B6%D0%BD%D0%BE%D1%81%D1%82%D0%B8-%D0%BF%D1%80%D0%B8-%D1%81%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B8-%D0%BF%D0%B5%D1%80%D0%B2%D0%BE%D0%B9-%D0%BD%D0%B0%D1%81%D1%82%D0%BE%D0%BB%D1%8C%D0%BD%D0%BE%D0%B9-%D0%B8%D0%B3%D1%80%D1%8B-%D0%BD%D0%B0-javascript-%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D1%84%D0%B5%D0%B9%D1%81-%D0%BC%D1%83%D0%BB%D1%8C%D1%82%D0%B8%D0%BF%D0%BB%D0%B5%D0%B5%D1%80-%D0%B1%D0%BE%D1%82" aria-label="какие сложности при создании первой настольной игры на javascript интерфейс мультиплеер бот permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Какие сложности при создании первой настольной игры на JavaScript (интерфейс, мультиплеер, бот)</h4><p><figure class="gatsby-resp-image-figure">
    <span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:700px">
      <a class="gatsby-resp-image-link" href="/static/c648b42c95bf3a0393fd7ba6de818755/c1b63/asset-1.png" style="display:block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom:66.28571428571429%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAACk0lEQVQ4y62Sz08TQRTH+0fo2YPx4EETgxINIlC4aiDRGMy2WENSEyJCKa0trYqKtCAIITFEKVpFE9KwtKF37178EY2JXAClQZRS113Y3dm+rzPbIhA8+rLffW9m3vvMm9l1NBw+VOeproS3oQZX66vhdZ62vafqBNwnK3Dp+FE0V+zUkb+xVHkMrTWn4K0/g9baKlQfPFDvSLU01qjDYcscjTA95mPmgJ+rq+z9TI937ZaY43kGjw0eG0NBxnjt+v1OS77cVOdIp9O1hq6DiMCNFnLr9GVhhUxTp01dJ6tYpC0TsTn/ifKr30lRVWKMUbG0DtM0MTc357SBJmMoG+kmw6ZhgvEEngyeDg6CZVn2ptaGBg6yJeZFjXiJ8TaQF9srokI8ZUCxaNmxgAvZy9hhdnrpaGxXh2Xg1m78FLyz0oCJrnggehEd7QKWCvZ2aBgl4I81hXoTr/Fu6iXwagS/Ew+gTcShPYlDfTwAdXIYWnKkpGcPuR+Ftba6t0PDMGzg4vIaneuYRLRvCvN3b0Dp9yE/dgeF0VvQxiJQe66g4JdQCLihBFxQgi1gywtloLEN1HUbSIu5PEmhKTrrS5InkKCOvmlqi6XJPzRLq/kM/Xo/QUZfO5k9l0kJeUi56SWWWxJAMo0yMJPJiK9sTy6tFIoXAy/ogj9J57lv5OCmzqfUyNUSTZIr+pzGE1n6MJkgrd9HKofSyjdxvWTxO8xms05HKpWq1TTNvt7F5Z/wDcpoj83ANyCjs6yO+Ayux2R4e6fxaPYNPr/9iMJ4P9aHQtjMfYXFqzf47yTLstPhcrn2RSKR5nA47AqFQpK/O/BPBYLc+7ul2L3b0mA0IAWvtUkhPhfmNaJWMNxu937H/7Y/ig/flQvSs7YAAAAASUVORK5CYII=&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="[https://lehasvv2009.github.io/territories](https://lehasvv2009.github.io/territories)" title="[https://lehasvv2009.github.io/territories](https://lehasvv2009.github.io/territories)" src="/static/c648b42c95bf3a0393fd7ba6de818755/8c557/asset-1.png" srcSet="/static/c648b42c95bf3a0393fd7ba6de818755/4edbd/asset-1.png 175w,/static/c648b42c95bf3a0393fd7ba6de818755/13ae7/asset-1.png 350w,/static/c648b42c95bf3a0393fd7ba6de818755/8c557/asset-1.png 700w,/static/c648b42c95bf3a0393fd7ba6de818755/e996b/asset-1.png 1050w,/static/c648b42c95bf3a0393fd7ba6de818755/c1b63/asset-1.png 1200w" sizes="(max-width: 700px) 100vw, 700px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
  </a>
    </span>
    <figcaption class="gatsby-resp-image-figcaption">[https://lehasvv2009.github.io/territories](https://lehasvv2009.github.io/territories)</figcaption>
  </figure></p><p><em>Статья может быть интересна разработчикам, у которых есть опыт с JavaScript и React, но нет опыта в разработке игр.</em></p><p>Идея написать игру у меня уже давно возникла, но вот какую — идеи не было. И вот однажды мой друг скинул мне пост на Пикабу с <a href="https://pikabu.ru/story/prikolnaya_miniigra_stoit_poprobovat_6269129" target="_blank" rel="nofollow noopener noreferrer"><strong><em>правилами игры</em></strong></a>. Что-то меня в ней зацепило. Наверное, простота и желание похвастаться своей игрой. И вот хвастаюсь — решил я запилить <a href="https://lehasvv2009.github.io/territories/" target="_blank" rel="nofollow noopener noreferrer"><em>свою игру</em></a>.</p><blockquote><p>Вкратце (а может и не вкратце), суть игры следующая. Есть большая доска (15<!-- -->*<!-- -->40 ячеек) с кучей пустых ячеек, 2 игрока и 2 кубика. Игрок бросает 2 кубика. Значения, которые выпали на кубиках (например, 3 и 4) являются длиной и шириной прямоугольника игрока. Игрок должен поставить этот прямоугольник на доску так, чтобы хотя бы одна его сторона соприкасалась с его ранее поставленными прямоугольниками. Если некуда поставить — пропускает ход. И так по очереди. Самые первые прямоугольники игроков ставятся в противоположные углы доски. Выигрывает тот, кто занял больше половины ячеек доски своими прямоугольниками.</p></blockquote><p><img src="/b13c0607c3be1be81a9450205b05aa11/asset-2.gif"/></p><p>Благодаря случайной фразе супруги о том, что было бы круто еще и иметь онлайн-версию, я нашел одну прекрасную библиотеку— <a href="https://boardgame.io" target="_blank" rel="nofollow noopener noreferrer"><strong><em>boardgame.io</em></strong></a>, чуть-чуть <a href="https://github.com/nicolodavis/boardgame.io/blob/master/CONTRIBUTING.md#contributor-license-agreement" target="_blank" rel="nofollow noopener noreferrer">связанной с <em>Google</em></a>, которая помогает неопытным разработчикам игр создавать простые пошаговые игры. Так что отчасти данная статья — это описание этой библиотеки.</p><p><figure class="gatsby-resp-image-figure">
    <span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:700px">
      <a class="gatsby-resp-image-link" href="/static/5c92c7149cf9d082b8ba77caec644490/5a190/asset-3.png" style="display:block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom:76.57142857142857%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAAC8ElEQVQ4y61TS08UQRCeKyZGokaM0cSTTGB57aIxugYDQzA+MB78BV5FDPFAZGd2ITHRo3/Bq965mOjB6EVvKg8XFnYX9jnv9053l9WzCwImnqzkS1V1ur/+6usZoffipUtjY2kYn5qCqdvTcGf6Ady6ex/SN8dhOHXln0hevgrX0mNwY3wCRq5fg56z5/qEmdknYrVW93TdYLquE8MwiGlaxDBNomPNe14bZrvWD/S1ej3e27B09urLW//kvWRCyGUUsWnogRP4gEER7CAIIcxxbOY5PnNtlwVeyBzbYTSibDH7kn388InvA9Uxw4dPHyUERZZFy7aDiHIuYBQzB6GE9+B5HmzkN2Cjug6Fah4K9Tzkt39BSS3Au+VlWNsqxISBH4QvcksJYX5+XtQ0PYB2MAzYA48wDGFzswAr5R+wVlqF1fIKrBXWYKX0E4pqHTwg8UY/CMKMnEkIWUURVSQMW62/CGlbdRw0AiARi8GXoxZFP7Cg7Zvx4lCW5YSw8Py56Lpu0Flne8psx4V6U4OGqnegQV3V4tzUDFB1AzTDBN2wmGm74DhuuLS0iB4qsoivdkhh7EkQxqSu58dwXG8/o13Q9prtH/BxUVGUhCDLGdG0LO7pIUJ+kCvZ648Gn4iDcNZYQIcws7Ag2rYTEEIPEaLJUNqpQnGnArWGGpPz0XnmoxqWDYZpg2k5LGxF/GsIc7ksPkpWETXdCFBy5+KYkeG4bH1jixXLFbaNKFdq+0BvGRIzvIC1oojuKYwfJYseep4fHh0pIgQqtSZUUZ1qWKCjGg2zqptxNm0HXD/4c4DQVi6LCmfmZnvLlV0XfyuwLIsgqG3btNFs0tX1PM1vbtGtYplul3biXMRc3tml9UaDqk2Vvvn+mS5+XYbX3977j5/N9QvHT3V3JS+n0qlUahIxgZBGR0elZDIpDQwMSiMjSWloaBgxJA0ND2M/Ig0MDkr9iYTU19cvCedPTgg9XZPChe70iTOnjwn/O34D2JGNNRk5TL8AAAAASUVORK5CYII=&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="[https://boardgame.io](https://boardgame.io)" title="[https://boardgame.io](https://boardgame.io)" src="/static/5c92c7149cf9d082b8ba77caec644490/8c557/asset-3.png" srcSet="/static/5c92c7149cf9d082b8ba77caec644490/4edbd/asset-3.png 175w,/static/5c92c7149cf9d082b8ba77caec644490/13ae7/asset-3.png 350w,/static/5c92c7149cf9d082b8ba77caec644490/8c557/asset-3.png 700w,/static/5c92c7149cf9d082b8ba77caec644490/5a190/asset-3.png 800w" sizes="(max-width: 700px) 100vw, 700px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
  </a>
    </span>
    <figcaption class="gatsby-resp-image-figcaption">[https://boardgame.io](https://boardgame.io)</figcaption>
  </figure></p><p>Библиотека описывает набор правил, общих для всех пошаговых игр — <strong><em>ходы</em></strong><em>,</em> <strong><em>события</em></strong><em>,</em> <strong><em>случайность</em></strong> и т.д., а также умело хранит <strong><em>состояние</em></strong>, под капотом используя <a href="https://redux.js.org/" target="_blank" rel="nofollow noopener noreferrer"><em>Redux</em></a>. Она также помогает реализовать серверную часть для игр <strong><em>онлайн</em></strong>. И еще есть раздел создания <strong><em>ботов</em></strong>. Жаль, что многое в ней еще не реализовано или не дореализовано.</p><p>Немного поигравшись с библиотекой, и реализовав крестики-нолики с ботом <a href="https://boardgame.io/#/tutorial" target="_blank" rel="nofollow noopener noreferrer"><em>по руководству</em></a> и онлайн крестики-нолики <a href="https://boardgame.io/#/multiplayer" target="_blank" rel="nofollow noopener noreferrer"><em>по другому руководству</em></a>, я начал пробовать реализовать свою игру. Дизайн приложения был только в голове и немного на листике, так что моя первая относительно рабочая попытка выглядела как-то так:</p><p><figure class="gatsby-resp-image-figure">
    <span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:700px">
      <a class="gatsby-resp-image-link" href="/static/488110d360883a8e7537515c49b8420f/5a190/asset-4.png" style="display:block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom:100.57142857142858%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsSAAALEgHS3X78AAAC7klEQVQ4y52Uz08TURDHe0ANeFYQEAQLFlqgrDSciJy8G/8AE48eCILQIMhPkYMnEmMaLxjTxKKtMZpgjCaY4KJo0MAVxaStoUB/QX/sbvvaceZ1t7b81km+eW+nO583M2+2Oh3aZUGovtRutpjMzUJbW7sgXLQITWZBaLG0ChaUGfeNjeZ8NTQI9XVGoba2TtDray1GY8N5nWoF9ZXn3huMVVBtqFeaW1qZwdTEaupMTG8wscrqGlZcUs5OFZey0yVlfM3sz7IzZRWsvKJKqazSQ0lp+SyyjhGw6EbHzfmhkXswODKa6h8chqHRuzA8Ng7W2wPQdasXunqs0I3q7O7BZys+90JHdx/0D47A2PhE6sFDG3R0di0g6yQBC2c/fhUj0RigJVHpo0iWJL6iMQpcX1//lAUuLS+LkiRDJBJhtOJLkEql8kQ+WZYhGAzC5uYmMNWPKwe63e7PWaDX4xbJmUgkGAVC5ug8kSmKwoGBQIDe5X6GRr95PJ6/wHcf5sXfvgCEgkFGQVpWuWD1QA70er0QjUa5L6VmmAXC3NXC632PRPvMd3QzFo3FeWkUvBNIh4XDYQ7F9mit2QFcuFJ0zYrAN8vkZ/G4tC+QfBsbG1xaX3cBv0xcKLTefyrOiCuHAqldi4uLsLa2ppW7G0hzuPLjJ78UBDGCHZQh3XBOuXsDf62uHglIPdza2sr2UZIk0OYwD7iaA6Sgg4ChUAi2t7d5lupEHAKkDBNJSNDYEEyF5t4yZRmPx3mGBwMliSkIk4N+SISDe/bQ7/dzJZPJ/QdbA0qxGFOQEXvxOC29fJJJjtHHk858v7KcxnL5ihztu94TOKcCFRlfiM08Y9JbJ0WwVDLJqCxqPrUEy2SYIcNLYVg67RUVOJ8tGefqG/yD0bhos0h9JPP5fEsa8PjU1NQdp9P52uFwPEe5HNPTGdFe1TQ+2+12vtpsNtfk5KQLY0hOl8v1ChlDyDqhw1vj/9qUqXrC/6pAFEXdH6vemNi4e1rvAAAAAElFTkSuQmCC&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="Первая попытка (справа Debug UI от boardgame.io)" title="Первая попытка (справа Debug UI от boardgame.io)" src="/static/488110d360883a8e7537515c49b8420f/8c557/asset-4.png" srcSet="/static/488110d360883a8e7537515c49b8420f/4edbd/asset-4.png 175w,/static/488110d360883a8e7537515c49b8420f/13ae7/asset-4.png 350w,/static/488110d360883a8e7537515c49b8420f/8c557/asset-4.png 700w,/static/488110d360883a8e7537515c49b8420f/5a190/asset-4.png 800w" sizes="(max-width: 700px) 100vw, 700px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
  </a>
    </span>
    <figcaption class="gatsby-resp-image-figcaption">Первая попытка (справа Debug UI от boardgame.io)</figcaption>
  </figure></p><p>Самое главное на этом этапе, что нужно было сделать — это описать логику, нарисовать интерфейс и связать их. В итоге оказалось, что для логики игры самое важное — это объект <strong><em>Game</em></strong>, который был описан примерно следующим образом:</p><pre><div class="prism-code language-undefined" style="color:rgba(0, 0, 0, 0.84);background-color:rgb(243, 243, 243)"><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">import { Game } from &quot;boardgame.io/core&quot;;</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">const Territories = Game({</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">  name: &quot;territories&quot;,</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">  // Инициализация первичного состояния игры</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">  // (доска с пустыми ячейками, кубики без значений)</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">  setup: () =&gt; ({</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    board: [...Array(15).fill([...Array(40).fill(&#x27;EMPTY&#x27;)])],</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    dices: null,</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    ...</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">  }),</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">  // Возможные действия с состоянием игроки (как actions в redux)</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">  moves: {</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    // Бросок костей (2 кубика D6)</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    rollDices: (G, ctx) =&gt; ({ </span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">      ...G,</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">      dices: ctx.random.D6(2)</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    }),</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    // Поставить прямоугольник на доску</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    dropRectangle: (</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">      G,</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">      ctx,</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">      rowIndex,</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">      columnIndex,</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">      rectangleHeight,</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">      rectangleWidth</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    ) =&gt; {</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">      // Сложная функция пересчета состояния ячеек доски</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">      // После того, как игрок поставил свой прямоугольник на доску</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">      return { ...G, board: G.board.map(row =&gt; ...) }</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    },</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">  },</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">  flow: {</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    // Заканчивать игру, когда один из игроков занял половину доски</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    endGameIf: (G, ctx) =&gt; {</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">      ...</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    },</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">  }</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">});</span></div></div></pre><p>Объект <strong><em>Game</em></strong> состоит из начального состояния игры, из действий, изменяющих это состояние, и из проверки завершения игры (вызывается каждый раз при любом действии). Состояние приложения состоит из двух главных объектов — <strong><em>G</em></strong> и <strong><em>ctx</em></strong>. <strong><em>G</em></strong> — это состояние игры, описанное разработчиком, относящееся к особенностям игры (например, доска и кубики в моей игре). <strong><em>ctx</em></strong> — это общие для всех пошаговых игр сущности (например, текущий игрок <strong><em>ctx.currentPlayer</em></strong> или счетчик хода <strong><em>ctx.turn</em></strong>).</p><p>Главный класс интерфейса выглядел следующим образом:</p><pre><div class="prism-code language-undefined" style="color:rgba(0, 0, 0, 0.84);background-color:rgb(243, 243, 243)"><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">class UI extends React.Component {</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">  handleRollDices = () =&gt; {</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    this.props.moves.rollDices();</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">  }</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">  handleDropRectangle = ({</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    rowIndex,</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    columnIndex,</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    rectangleHeight,</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    rectangleWidth</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">  }) =&gt; {</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    this.props.moves.dropRectangle(</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">      rowIndex,</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">      columnIndex,</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">      rectangleHeight,</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">      rectangleWidth</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    );</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    this.handleEndTurn();</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">  }</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">  handleEndTurn = () =&gt; {</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    this.props.events.endTurn();</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">  }</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">  render() {</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    const {</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">      G: { board, dices },</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">      ctx: { currentPlayer, gameover }</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    } = this.props;</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    return (</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">      &lt;React.Fragment&gt;</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">        &lt;PlayersControls</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">          dices={dices}</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">          currentPlayer={currentPlayer}</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">          onRollDices={this.handleRollDices}</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">          onSkipTurn={this.handleEndTurn}</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">        /&gt;</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">        &lt;Board</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">          rows={board}</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">          onDropRectangle={this.handleDropRectangle}</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">        /&gt;</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">        &lt;Congratulations</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">          gameover={gameover}</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">        /&gt;</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">      &lt;/React.Fragment&gt;</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    );</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">  }</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">}</span></div></div></pre><p>Из интерфейса можно вызывать действия <strong><em>this.props.moves</em></strong>, которые описаны в объекте <em>Game</em> и изменяют состояние <strong><em>G</em></strong><em>.</em> Можно также вызывать события <strong><em>this.props.events</em></strong> — это те же действия, только изменяющие состояние <strong><em>ctx</em></strong> (одинаковая для всех игр модель состояния).</p><p>Чтобы связать интерфейс <em>UI</em> и состояние <em>Game</em>, нужно написать что-то похожее:</p><pre><div class="prism-code language-undefined" style="color:rgba(0, 0, 0, 0.84);background-color:rgb(243, 243, 243)"><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">import { Client } from &quot;boardgame.io/react&quot;;</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">import Game from &quot;./Game&quot;;</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">import UI from &quot;./UI&quot;</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">const Territories = Client({</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">  game: Game,</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">  board: UI,</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">  debug: false</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">});</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">export default Territories;</span></div></div></pre><p>Но, хватит про библиотеку (пусть, она еще не раз будет встречаться). В целом, реализацию игры можно разбить на <strong><em>3 последовательных этапа</em></strong>:</p><ul><li>Реализация <strong><em>логики игры</em></strong> и <strong><em>пользовательского интерфейса</em></strong> (игра один на один оффлайн)</li><li>Реализация <strong><em>мультиплеера</em></strong> (игра один на один онлайн)</li><li>Реализация <strong><em>бота</em></strong> (игра против искусственного интеллекта)</li></ul><p>Далее будут расписаны основные сложности, которые встречались на моем пути.</p><h3 id="сложности-при-реализации-пользовательского-интерфейса" style="position:relative"><a href="#%D1%81%D0%BB%D0%BE%D0%B6%D0%BD%D0%BE%D1%81%D1%82%D0%B8-%D0%BF%D1%80%D0%B8-%D1%80%D0%B5%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D0%B8-%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8C%D1%81%D0%BA%D0%BE%D0%B3%D0%BE-%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D1%84%D0%B5%D0%B9%D1%81%D0%B0" aria-label="сложности при реализации пользовательского интерфейса permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Сложности при реализации пользовательского интерфейса</h3><h4 id="drag-and-drop-vs-mouse-enter" style="position:relative"><a href="#drag-and-drop-vs-mouse-enter" aria-label="drag and drop vs mouse enter permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Drag-and-Drop vs Mouse-Enter</h4><p><img src="/d4b0445b9dac0bd9cde9f136030031f2/asset-5.gif"/></p><p>При первом дизайне казалось, что воспользоваться <strong><em>drag-and-drop</em></strong> для перемещения прямоугольника на доску — это отличная идея. Поэтому я решил попробовать популярную библиотеку <a href="https://github.com/react-dnd/react-dnd" target="_blank" rel="nofollow noopener noreferrer"><strong><em>react-dnd</em></strong></a>. Оказалось, что подход, используемый в библиотеке, не так уж и прост в случае, когда цель дропа — это изменяющийся набор ячеек. Так что я потратил неделю на его реализацию (с параллельными попытками использования <a href="https://github.com/mzabriskie/react-draggable" target="_blank" rel="nofollow noopener noreferrer">других</a> <a href="https://github.com/react-dropzone/react-dropzone" target="_blank" rel="nofollow noopener noreferrer"><em>drag-and-drop</em></a> библиотек). Однако после реализации перетаскивание прямоугольника визуально тормозило приложение. Я решил попробовать реализовать тот же перенос прямоугольника через простой <strong><em>mouse-enter + click</em></strong>, и сделал это за полдня без проблем с производительностью. Выглядело даже очевиднее (ну, кроме мобилки, там <strong><em>touch-move</em></strong> помог). На нем и остановился.</p><p><strong>Вывод</strong>. Для перетаскивания компонентов в другие компоненты есть 2 подхода — <strong><em>drag-and-drop</em></strong> и <strong><em>mouse-enter + click</em></strong>. Если он простой и захотите воспользоваться <strong><em>react-dnd</em></strong> — все получится. Если сложный — стоит рассмотреть <strong><em>mouse-enter</em></strong> подход, как более простой в реализации.</p><h4 id="игральные-кости" style="position:relative"><a href="#%D0%B8%D0%B3%D1%80%D0%B0%D0%BB%D1%8C%D0%BD%D1%8B%D0%B5-%D0%BA%D0%BE%D1%81%D1%82%D0%B8" aria-label="игральные кости permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Игральные кости</h4><p><img src="/77de87bbb874357fc3c0a862585d019c/asset-6.gif"/></p><p>Какая настольная игра без игральных костей?! (Ticket to ride, Saboteur, да куча). В этой игре они нужны. И, мне очень понравился дизайн игры <a href="http://monopoly-club.org/" target="_blank" rel="nofollow noopener noreferrer"><em>http://monopoly-club.org</em></a>, так что я начал искать красивые кости, как у них. Оказывается, не так уж и просто найти красивые, готовые и бесплатные 3d-модели для веб! Сначала я просто воспользовался <a href="https://github.com/AdamTyler/react-dice-complete" target="_blank" rel="nofollow noopener noreferrer"><em>этим проектом</em></a>, так как там было достаточно функциональности для логики. Но, красота требует жертв. Так что, через недели полторы скитаний по просторам интернета и неудачных попыток готовых решений я нашел прекрасную реализацию красивых 3d кубиков— <a href="http://www.teall.info/2014/01/online-3d-dice-roller.html" target="_blank" rel="nofollow noopener noreferrer"><strong><em>http://www.teall.info/2014/01/online-3d-dice-roller.html</em></strong></a>. После этого немного изучений <a href="https://threejs.org/" target="_blank" rel="nofollow noopener noreferrer"><strong><em>three.js</em></strong></a>, немного настроек — и кубики <em>3</em> и <em>6</em> отлично катятся в 3d на <strong><em>WebGL</em></strong> со следующим кодом:</p><pre><div class="prism-code language-undefined" style="color:rgba(0, 0, 0, 0.84);background-color:rgb(243, 243, 243)"><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">&lt;Dices3d</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">  dices={[{</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    type: &quot;d6&quot;,</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    backColor: &quot;red&quot;,</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    fontColor: &quot;white&quot;,</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    value: 3</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">  }, {</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    type: &quot;d6&quot;,</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    backColor: &quot;blue&quot;,</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    fontColor: &quot;white&quot;,</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    value: 6</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">  }]}</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">/&gt;</span></div></div></pre><p><strong>Вывод.</strong> Довольно непросто найти готовые, красивые и бесплатные 3d модели для специфичных компонентов. Так что или учите <a href="https://threejs.org/" target="_blank" rel="nofollow noopener noreferrer"><strong><em>three.js</em></strong></a> (или аналоги, как <a href="https://www.babylonjs.com/" target="_blank" rel="nofollow noopener noreferrer"><strong><em>babylon.js</em></strong></a>), или рассчитывайте на небыстрое и негарантированное нахождение готового.</p><h3 id="сложности-при-реализации-логики-игры" style="position:relative"><a href="#%D1%81%D0%BB%D0%BE%D0%B6%D0%BD%D0%BE%D1%81%D1%82%D0%B8-%D0%BF%D1%80%D0%B8-%D1%80%D0%B5%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D0%B8-%D0%BB%D0%BE%D0%B3%D0%B8%D0%BA%D0%B8-%D0%B8%D0%B3%D1%80%D1%8B" aria-label="сложности при реализации логики игры permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Сложности при реализации логики игры</h3><h4 id="производительность-при-подсчете-победы" style="position:relative"><a href="#%D0%BF%D1%80%D0%BE%D0%B8%D0%B7%D0%B2%D0%BE%D0%B4%D0%B8%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D0%BE%D1%81%D1%82%D1%8C-%D0%BF%D1%80%D0%B8-%D0%BF%D0%BE%D0%B4%D1%81%D1%87%D0%B5%D1%82%D0%B5-%D0%BF%D0%BE%D0%B1%D0%B5%D0%B4%D1%8B" aria-label="производительность при подсчете победы permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Производительность при подсчете победы</h4><p><img src="/18ed3332639217b9b217cc8667fe387e/asset-7.gif"/></p><p>Игра должна заканчиваться, когда один из игроков занял больше, чем половину доски. Фреймворк <em>boardgame.io</em> в конце каждого хода вызывает метод <strong><em>endGameIf</em></strong>. И, если метод что-то возвращает, то игра заканчивается. Первой реализацией этого метода было прохождение по всей доске, которое считает количество занятых игроком ячеек и сравнивает его с половиной числа всех ячеек. В итоге, визуально казалось, что в конце хода игра немного тормозит. Поэтому было решено добавить в объект состояния <em>G</em> счетчики для каждого игрока <code class="prism-code language-undefined" style="color:rgba(0, 0, 0, 0.84);background-color:rgb(243, 243, 243)"><span class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">G.occupiedCells.PLAYER_1 = 0</span></span></code>. Эти счетчики увеличивались, как только игрок ставил прямоугольник на доску. Это сделало функцию победы быстрее, так как оставалось только сравнивать счетчики с половиной числа всех ячеек. Однако, когда были какие-то нововведения в игру (например, автоматический захват территорий, уже не доступных для другого игрока), нужно было не забывать обновлять эти счетчики.</p><p><strong>Вывод.</strong> Если производительность функции победы плохо влияет на приложение, можно считать важные для победы параметры в ходе игры и сохранять их в состоянии, как <strong><em>кэш</em></strong>. Но, после внедрения их нужно не забывать про их существование и инвалидацию, особенно если появляется новая функциональность.</p><h4 id="алгоритм-нахождения-всех-ячеек-для-автозаполнения" style="position:relative"><a href="#%D0%B0%D0%BB%D0%B3%D0%BE%D1%80%D0%B8%D1%82%D0%BC-%D0%BD%D0%B0%D1%85%D0%BE%D0%B6%D0%B4%D0%B5%D0%BD%D0%B8%D1%8F-%D0%B2%D1%81%D0%B5%D1%85-%D1%8F%D1%87%D0%B5%D0%B5%D0%BA-%D0%B4%D0%BB%D1%8F-%D0%B0%D0%B2%D1%82%D0%BE%D0%B7%D0%B0%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D1%8F" aria-label="алгоритм нахождения всех ячеек для автозаполнения permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Алгоритм нахождения всех ячеек для автозаполнения</h4><p><img src="/ce063e8f5061533e27cd85fc75eb0319/asset-8.gif"/></p><p>Когда игра была в какой-то мере реализована и были сыграны несколько тестовых игр, было замечено, что в процессе игры появляются ячейки, которые могут быть захвачены только одним игроком. Например, ячейки, которые с трех сторон окружены ячейками первого игрока, а с четвертой — границей доски. В итоге первый игрок очень долго выкидывал кости, чтобы рано или поздно занять эти ячейки. Игра сильно растягивалась и пропадал интерес в ее играть.</p><p>Поэтому было решено отдавать ячейки игроку, если только он может ими завладеть. Такие ячейки могли появляться только когда игрок ставит прямоугольник. Однако как в двумерном массиве (доска — это двумерный массив) найти множество ячеек, которые замкнуты в контуре первого игрока или границы? Решение пришло не сразу. В основном я пытался искать статьи, которые описывают решения задач поиска замкнутого контура. Например, <a href="https://habr.com/ru/post/305002/" target="_blank" rel="nofollow noopener noreferrer"><em>вот эта</em></a> или <a href="http://e-maxx.ru/algo/finding_cycle" target="_blank" rel="nofollow noopener noreferrer"><em>вот эта</em></a>.</p><p>В итоге, после тщетных попыток быстро понять, в чем смысл сложных алгоритмов, я пришел к рекурсивной реализации заливки в <strong><em>Paint (</em></strong><a href="https://en.wikipedia.org/wiki/Flood_fill" target="_blank" rel="nofollow noopener noreferrer"><strong><em>flood-fill</em></strong></a><strong><em>)</em></strong>. Алгоритм просто рекурсивно проходит по всем соседям ячейки и закрашивает до тех пор, пока не дойдет до граничной. Как всегда, есть даже готовые библиотеки в <em>npm</em>. Довольно быстро я реализовал алгоритм, который рекурсивно проходит по всем свободным ячейкам в стиле заливки (на самом деле, в стиле поиска в глубину), собирая ячейки в контур и информацию о том, кто соседи контура. Если соседи — первый игрок и граница, то эти ячейки можно отдавать первому игроку. Если второй игрок и граница — то второму. Если первый и второй игрок — то никому. Алгоритм считается очень простым и далеко не оптимизированным, но отлично справился с задачей, не имея визуальных проблем с производительностью.</p><p><strong>Вывод.</strong> Не стоит бояться использовать <strong><em>простые алгоритмы</em></strong>, если их можно быстро реализовать. Возможно этого будет достаточно для решения задачи. И сэкономит кучу времени.</p><h3 id="сложности-при-реализации-мультиплеера" style="position:relative"><a href="#%D1%81%D0%BB%D0%BE%D0%B6%D0%BD%D0%BE%D1%81%D1%82%D0%B8-%D0%BF%D1%80%D0%B8-%D1%80%D0%B5%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D0%B8-%D0%BC%D1%83%D0%BB%D1%8C%D1%82%D0%B8%D0%BF%D0%BB%D0%B5%D0%B5%D1%80%D0%B0" aria-label="сложности при реализации мультиплеера permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Сложности при реализации мультиплеера</h3><h4 id="развертывание" style="position:relative"><a href="#%D1%80%D0%B0%D0%B7%D0%B2%D0%B5%D1%80%D1%82%D1%8B%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5" aria-label="развертывание permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Развертывание</h4><p>Фреймворк <em>boardgame.io</em> предоставляет довольно широкие возможности мультиплеера. Например, <a href="https://boardgame.io/#/api/Server" target="_blank" rel="nofollow noopener noreferrer"><strong><em>сервер</em></strong></a>, который <a href="https://boardgame.io/#/storage" target="_blank" rel="nofollow noopener noreferrer"><em>хранит информацию</em></a> про игры, <a href="https://boardgame.io/#/multiplayer" target="_blank" rel="nofollow noopener noreferrer"><em>работает с пользователями</em></a> и предоставляет <a href="https://boardgame.io/#/api/API" target="_blank" rel="nofollow noopener noreferrer"><em>API для комнат</em></a> и для игры онлайн, а также <a href="https://boardgame.io/#/api/Client" target="_blank" rel="nofollow noopener noreferrer"><strong><em>клиент</em></strong></a>, который общается с сервером при помощи <strong><em>http</em></strong> или <strong><em>websocket</em></strong>. В ней все еще не хватает множества фич (хорошей аутентификации, удаления комнат и т.д.), но для простых игр достаточно. Например, так выглядит код для запуска сервера игры:</p><pre><div class="prism-code language-undefined" style="color:rgba(0, 0, 0, 0.84);background-color:rgb(243, 243, 243)"><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">import { Server } from &quot;boardgame.io/server&quot;;</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">import Game from &quot;../Game&quot;;</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">const port = process.env.PORT || 8000;</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">const server = Server({ games: [Game] });</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">server.run(port, () =&gt; {</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">  console.log(&quot;App is running on port &quot; + port);</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">});</span></div></div></pre><p>Для развертывания были выбраны <a href="https://www.heroku.com/" target="_blank" rel="nofollow noopener noreferrer"><strong><em>heroku</em></strong></a> для сервера, <a href="https://pages.github.com/" target="_blank" rel="nofollow noopener noreferrer"><strong><em>github-pages</em></strong></a> для клиента и <a href="https://travis-ci.org/" target="_blank" rel="nofollow noopener noreferrer"><strong><em>travis</em></strong></a> в качестве <em>Continuous integration</em> и <em>Continuous deployment</em>. Причина? Все бесплатно, не требует особой поддержки и легко интегрируется с <a href="https://github.com/" target="_blank" rel="nofollow noopener noreferrer"><strong><em>github</em></strong></a>.</p><pre><div class="prism-code language-undefined" style="color:rgba(0, 0, 0, 0.84);background-color:rgb(243, 243, 243)"><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">...</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">deploy:</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">  provider: heroku</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">  app: territories-backend</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">  skip_cleanup: true</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">  api_key:</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    secure: ...</span></div></div></pre><p>Изначально все проекты (клиент и сервер) находились в одном репозитории. Однако, из-за того, что <a href="https://docs.travis-ci.com/user/deployment/heroku/" target="_blank" rel="nofollow noopener noreferrer"><em>travis heroku provider</em></a> не имел поддержки работы с подпапками, были выделены отдельные <em>github</em> репозитории для клиента и сервера. Что привело к еще нескольким концептуально правильным сложностям. Например, чтобы не дублировать код, я создал еще один репозиторий <em>territories-core</em>, в котором находились общие для клиента и сервера функции — много функций логики игры и объект <em>Game</em>.</p><pre><div class="prism-code language-undefined" style="color:rgba(0, 0, 0, 0.84);background-color:rgb(243, 243, 243)"><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">territories</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">| - core</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">| - frontend</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">| - backend</span></div></div></pre><p>Репозиторий <em>territories-core</em> подключался, как модуль из <em>github</em>, на сервер <em>territories-backend</em> и на клиент <em>territories-frontend</em>. Однако я бы все-таки рекомендовал публиковать модуль через <code class="prism-code language-undefined" style="color:rgba(0, 0, 0, 0.84);background-color:rgb(243, 243, 243)"><span class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">npm publish</span></span></code> в <a href="https://www.npmjs.com/" target="_blank" rel="nofollow noopener noreferrer"><em>npmjs.com</em></a>, чем использовать <code class="prism-code language-undefined" style="color:rgba(0, 0, 0, 0.84);background-color:rgb(243, 243, 243)"><span class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">npm install github.com/user/repo</span></span></code>, так как появляются сложности со сборкой во время установки, с форматом версий и др.</p><pre><div class="prism-code language-undefined" style="color:rgba(0, 0, 0, 0.84);background-color:rgb(243, 243, 243)"><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">{</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">  &quot;name&quot;: &quot;territories-backend&quot;,</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">  ...</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">  &quot;dependencies&quot;: {</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    ...</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    &quot;territories-core&quot;: &quot;lehaSVV2009/territories-core#abdf08d&quot;</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">  }</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">}</span></div></div></pre><p>Подход с выделением отдельного репозитория для общих функций оказался красивым, но не всегда удобным для разработки, поэтому первое время я просто копировал код логики на клиент и сервер.</p><p>И тут настало время думать, что все пойдет хорошо. А нет! Оказалось, что сервер для <em>boardgame.io</em> запускал <em>HTTP API</em> на порту <code class="prism-code language-undefined" style="color:rgba(0, 0, 0, 0.84);background-color:rgb(243, 243, 243)"><span class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">8080</span></span></code>, а <em>Websocket API</em> на порту <code class="prism-code language-undefined" style="color:rgba(0, 0, 0, 0.84);background-color:rgb(243, 243, 243)"><span class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">8081</span></span></code>, поэтому, когда сервер был успешно закинут на <em>heroku</em>, он падал с ошибкой, что только один <em>API</em> с одним портом может быть запущен. Изначально я ставил на то, что это проблема <em>heroku</em>, и что стоит использовать что-то более функциональное и недорогое (<a href="https://aws.amazon.com/ec2/pricing/" target="_blank" rel="nofollow noopener noreferrer"><em>AWS EC2</em></a><em>,</em> <a href="https://cloud.google.com/free/" target="_blank" rel="nofollow noopener noreferrer"><em>Google Cloud Platform</em></a><em>,</em> <a href="https://www.openshift.com/trial/" target="_blank" rel="nofollow noopener noreferrer"><em>Openshift</em></a><em>,</em> <a href="https://www.digitalocean.com/pricing/" target="_blank" rel="nofollow noopener noreferrer"><em>Digital Ocean</em></a><em>,</em> <a href="https://azure.microsoft.com/en-us/free/" target="_blank" rel="nofollow noopener noreferrer"><em>Azure</em></a><em>,</em> и т.д.). Однако, со временем я заметил, что многим людям не нравилось 2 порта, так как было открыто около пяти <em>issues,</em> поэтому за несколько дней изучения проекта и реализации фичи <a href="https://github.com/nicolodavis/boardgame.io/pull/343/" target="_blank" rel="nofollow noopener noreferrer"><em>“один порт для http и websocket”</em></a>, это было исправлено и новая версия сервера нормально работала на <em>heroku</em>.</p><p><strong>Вывод.</strong> У фреймворка <em>boardgame.io</em> есть неплохая <a href="https://boardgame.io/#/multiplayer" target="_blank" rel="nofollow noopener noreferrer"><strong><em>поддержка мультиплеера</em></strong></a> в виде клиента и сервера, общающихся по <em>http</em> и <em>websocket</em>. Для простоты развертывания, например, на <a href="https://heroku.com" target="_blank" rel="nofollow noopener noreferrer"><strong><em>heroku</em></strong></a> или <a href="https://pages.github.com/" target="_blank" rel="nofollow noopener noreferrer"><strong><em>github-pages</em></strong></a>, можно создать отдельные репозитории для клиента и сервера. Тогда будет проще настраивать <a href="https://en.wikipedia.org/wiki/Continuous_integration" target="_blank" rel="nofollow noopener noreferrer"><em>CI</em></a> и <a href="https://en.wikipedia.org/wiki/Continuous_deployment" target="_blank" rel="nofollow noopener noreferrer"><em>CD</em></a>. Чтобы не дублировать код, который одинаковый для клиента и сервера, стоит вынести общую логику в отдельную модуль/репозиторий. Для небольших нагрузок все можно сделать бесплатно.</p><h4 id="комнаты" style="position:relative"><a href="#%D0%BA%D0%BE%D0%BC%D0%BD%D0%B0%D1%82%D1%8B" aria-label="комнаты permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Комнаты</h4><p><img src="/758d62416847de89c2501e958627b11f/asset-9.gif"/></p><p>Обычно, наличие мультиплеера предполагает возможность каким-нибудь образом подключиться к игре. Есть разные способы. Например, в <a href="https://agar.io/" target="_blank" rel="nofollow noopener noreferrer"><em>agar.io</em></a> все, что нужно, это ввести имя и нажать на кнопку “играть”, чтобы игра автоматически тебя подключила к какой-либо из комнат с множеством других игроков. В игре <a href="https://www.haxball.com" target="_blank" rel="nofollow noopener noreferrer"><em>haxball.com</em></a> игрок после ввода имени переходит на страницу с множеством комнат, в которые можно присоединиться, откуда можно выйти и где можно создавать свои комнаты. Так что, сначала стоит выбрать, какой способ больше подходит для игры.</p><p>И тут тоже на помощь может прийти <em>boardgame.io</em>. В документации об этом ни слова я не нашел, однако, если скачать их репозиторий и локально запустить <code class="prism-code language-undefined" style="color:rgba(0, 0, 0, 0.84);background-color:rgb(243, 243, 243)"><span class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">npm install &amp;&amp; npm start</span></span></code>, то по <a href="http://localhost:3000/#/lobby/main" target="_blank" rel="nofollow noopener noreferrer"><em>http://localhost:3000</em></a> можно увидеть несколько интересных примеров, в том числе пример комнат (<a href="https://github.com/nicolodavis/boardgame.io/blob/master/examples/react-web/src/lobby/lobby.js" target="_blank" rel="nofollow noopener noreferrer"><em>Lobby</em></a>). Он тоже еще в <a href="https://github.com/nicolodavis/boardgame.io/issues/354" target="_blank" rel="nofollow noopener noreferrer"><em>процессе разработки</em></a>, но многое уже готово. Тем более, что с недавних пор весь интерфейс можно полностью переопределять при помощи поля <code class="prism-code language-undefined" style="color:rgba(0, 0, 0, 0.84);background-color:rgb(243, 243, 243)"><span class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">renderer</span></span></code>.</p><pre><div class="prism-code language-undefined" style="color:rgba(0, 0, 0, 0.84);background-color:rgb(243, 243, 243)"><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">import { Lobby } from &quot;boardgame.io/react&quot;;</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">import Game from &quot;../Game&quot;;</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">import UI from &quot;../UI&quot;;</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">&lt;Lobby</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">  gameServer=&quot;http://localhost:8080&quot;</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">  lobbyServer=&quot;http://localhost:8080&quot;</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">  gameComponents={[{</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    game: Game,</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    board: UI,</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    loading: () =&gt; &lt;div&gt;Custom Loading...&lt;/div&gt;,</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">  }]}</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">  renderer={({</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    errorMsg,</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    gameComponents,</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    gameInstances,</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    phase,</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    playerName,</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    runningGame,</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    handleEnterLobby,</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    handleExitLobby,</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    handleCreateRoom,</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    handleJoinRoom,</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    handleLeaveRoom,</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    handleExitRoom,</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    handleRefreshRooms,</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    handleStartGame</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">  }) =&gt; {</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    if (phase === &quot;enter&quot;) {</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">      return &lt;button onClick={handleEnterLobby}&gt;Login&lt;/button&gt;;</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    }</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    if (phase === &quot;list&quot;) {</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">      return (</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">        &lt;div&gt;</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">          {gameInstances.map(game =&gt; (</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">            &lt;div key={game.gameID}&gt;</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">              {game.players.map(player =&gt; player.name)}</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">            &lt;/div&gt;</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">          )}</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">          &lt;button onClick={handleCreateRoom} /&gt;</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">        &lt;/div&gt;</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">      );</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    }</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    if (phase === &quot;play&quot;) {</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">      return (</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">        &lt;runningGame.app</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">          gameID={runningGame.gameID}</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">          playerID={runningGame.playerID}</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">          credentials={runningGame.credentials}</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">        /&gt;</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">      );</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    }</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    return &quot;Unknown phase&quot;;</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">  }}</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">/&gt;</span></div></div></pre><p>В данный момент <em>Lobby</em> при входе сохраняет имя пользователя в <em>cookies</em> и использует <a href="https://boardgame.io/#/api/API" target="_blank" rel="nofollow noopener noreferrer"><em>boardgame.io API</em></a> для управления комнатами. При входе в комнату он рендерит компонент <code class="prism-code language-undefined" style="color:rgba(0, 0, 0, 0.84);background-color:rgb(243, 243, 243)"><span class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">Client</span></span></code>, который, в свою очередь, подключается по <em>WebSocket</em> к серверу, отправляя ему название игры, идентификатор игры и индекс игрока. Как уже говорилось ранее, многое еще не реализовано или реализовано необычно (выход из игры, удаление комнаты, аутентификация, имена игроков), но достаточно для простых собственных проектов.</p><p>А вот еще несколько сложностей, связанных с реализацией мультиплеера после простой игры один на один:</p><ul><li>Состояние конца игры не приходило с сервера для победителя, поэтому пришлось реализовать его самому. Все еще есть баги..</li><li>Бросок кубика не отображался у других игроков, так как с сервера приходило лишь новое состояние кубиков и все. Поэтому пришлось разбивать бросание кубиков на “начать бросок” и “закончить бросок”, чтобы при начале броска всем другим игрокам приходили данные о том, что бросок начался и чтобы у них отображались крутящиеся 3d кубики.</li><li>Блокировка кнопок для неактивного игрока. Если сейчас ход второго игрока, то первый игрок не может ничего делать, кроме как наблюдать. Так что пришлось блокировать кнопки для пользователей, когда был не их ход.</li><li>Большое отличие интерфейса онлайн игры от интерфейса простой игры. Например, наличие кнопок “выйти из игры”, “выйти из комнаты”, обновление имен с сервера, блокировка кнопок для неактивного игрока и т.д. В компоненте оказалось слишком много <code class="prism-code language-undefined" style="color:rgba(0, 0, 0, 0.84);background-color:rgb(243, 243, 243)"><span class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">if (multiplayer)</span></span></code> кода. Я думаю, что стоило бы рассмотреть вариант создания отдельного <em>layout</em> компонента только для мультиплеера.</li></ul><p><strong>Вывод.</strong> И снова у фреймворка <em>boardgame.io</em> есть что-то неплохое, но недоделанное для онлайн комнат, а именно <a href="https://boardgame.io/#/api/API" target="_blank" rel="nofollow noopener noreferrer"><strong><em>API</em></strong></a> и <a href="https://github.com/nicolodavis/boardgame.io/blob/master/examples/react-web/src/lobby/lobby.js" target="_blank" rel="nofollow noopener noreferrer"><strong><em>Lobby</em></strong></a>. Для реализации простых игр и изучения логики комнат вполне достаточен, но для сложных проектов лучше создавать что-то свое или использовать готовое <a href="https://github.com/flackr/lobby/wiki/API" target="_blank" rel="nofollow noopener noreferrer"><em>другое</em></a>. Также скорее всего при реализации мультиплеера придется немного переделать состояние приложения и его интерфейс.</p><h3 id="сложности-при-реализации-бота" style="position:relative"><a href="#%D1%81%D0%BB%D0%BE%D0%B6%D0%BD%D0%BE%D1%81%D1%82%D0%B8-%D0%BF%D1%80%D0%B8-%D1%80%D0%B5%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D0%B8-%D0%B1%D0%BE%D1%82%D0%B0" aria-label="сложности при реализации бота permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Сложности при реализации бота</h3><h4 id="бот-на-основе-нейронной-сети" style="position:relative"><a href="#%D0%B1%D0%BE%D1%82-%D0%BD%D0%B0-%D0%BE%D1%81%D0%BD%D0%BE%D0%B2%D0%B5-%D0%BD%D0%B5%D0%B9%D1%80%D0%BE%D0%BD%D0%BD%D0%BE%D0%B9-%D1%81%D0%B5%D1%82%D0%B8" aria-label="бот на основе нейронной сети permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Бот на основе нейронной сети</h4><p>В документации фреймворка <em>boardgame.io</em> есть <a href="https://boardgame.io/#/tutorial?id=adding-ai" target="_blank" rel="nofollow noopener noreferrer"><strong><em>запись про добавление AI</em></strong></a>. Фреймворк реализует <a href="https://www.baeldung.com/java-monte-carlo-tree-search" target="_blank" rel="nofollow noopener noreferrer"><strong><em>MCTS</em></strong></a> алгоритм и предоставляет функцию для реализации, которая, на сколько я заметил, будет вызываться 1000 раз перед каждым ходом бота, чтобы понять, какой ход лучше сделать.</p><pre><div class="prism-code language-undefined" style="color:rgba(0, 0, 0, 0.84);background-color:rgb(243, 243, 243)"><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">// https://boardgame.io/#/tutorial?id=adding-ai</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">{</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">  enumerate: (G, ctx) =&gt; {</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    const moves = [];</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    for (let i = 0; i &lt; 9; i++) {</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">      if (G.cells[i] === null) {</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">        moves.push({ move: &#x27;clickCell&#x27;, args: [i] });</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">      }</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    }</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    return moves;</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">  }</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">}</span></div></div></pre><p>Однако, во-первых, поддержка искусственного интеллекта на данный момент еще в <a href="https://github.com/nicolodavis/boardgame.io/issues/7" target="_blank" rel="nofollow noopener noreferrer"><em>процессе разработки</em></a>, во-вторых, пока что фреймворк позволяет работать только с одним типом ходов (например, поставить крестик в случайную ячейку в крестики-нолики). В моей игре несколько типов ходов (бросить кубики, повернуть прямоугольник, поставить прямоугольник), поэтому, после нескольких неудачных попыток использовать готовый функционал, я начал изучать то, как можно реализовать своего бота.</p><p>И тут столько всего можно изучать! Нейронные сети, генетические алгоритмы, сложные собственные алгоритмы и т.д. Я остановился на нейронных сетях, так как всегда хотел попробовать их на реальном примере.</p><p>Что такое <strong><em>нейронная сеть</em></strong>? На самом деле, это просто функция, которая принимает несколько чисел и, в зависимости от типа сети, весов и слоев, возвращает какие-то значения. Например, примерно так может выглядеть самая простая линейная однослойная нейронная сеть с весами <em>0.12</em> и <em>0.45</em>:</p><pre><div class="prism-code language-undefined" style="color:rgba(0, 0, 0, 0.84);background-color:rgb(243, 243, 243)"><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">(arg1, arg2) =&gt; arg1 * 0.12 + arg2 * 0.45</span></div></div></pre><p>Есть очень много разных видов и категорий нейронных сетей. Наверное, самое популярная библиотека для работы с ними — это <a href="https://www.tensorflow.org/" target="_blank" rel="nofollow noopener noreferrer"><strong><em>TensorFlow</em></strong></a> (она написана на <em>Python</em>, как и большая часть библиотек для искусственного интеллекта, но есть <a href="https://www.tensorflow.org/js" target="_blank" rel="nofollow noopener noreferrer"><strong><em>Tensorflow.js</em></strong></a>). Немного поигравшись с ней, я понял, что мне это было рано. Поэтому, в очередной из десятков статей про лучшие библиотеки для нейронных сетей я нашел <a href="https://github.com/BrainJS/brain.js" target="_blank" rel="nofollow noopener noreferrer"><strong><em>brain.js</em></strong></a><em>.</em> Библиотека предоставляет множество простых методов для создания нейронных сетей, а также трансформацию нейронной сети в простую функцию на JS.</p><p>Например, моя нейронная сеть создавалась примерно следующим образом:</p><pre><div class="prism-code language-undefined" style="color:rgba(0, 0, 0, 0.84);background-color:rgb(243, 243, 243)"><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">import brain from &quot;brain.js&quot;</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">import myTrainingData from &quot;./trainingData&quot;</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">// Создание нейронной сети</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">const net = new brain.NeuralNetwork()</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">// Тренировка весов для нейронной сети</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">net.train(myTrainingData)</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">// Запуск нейронной сети для расчета вероятности правильности хода</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">// Вернет, например, число 0.87</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">const probability = net.run(...).chosenByWife;</span></div></div></pre><p>Есть несколько способов тренировки нейронной сети. Я использовал скучный и рабочий способ — <strong><em>тренировку с учителем</em></strong> (моей супругой), т.е. каждый раз, когда я проигрывал своей жене, все ее возможные ходы и те из них, которые она выбирала, записывались в формате <em>JSON</em> для последующей тренировки сети:</p><pre><div class="prism-code language-undefined" style="color:rgba(0, 0, 0, 0.84);background-color:rgb(243, 243, 243)"><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">[</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">  {</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    &quot;input&quot;: {</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">      &quot;turn&quot;: 0.0001,</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">      &quot;columnIndex&quot;: 0.875,</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">      &quot;rowIndex&quot;: 0.7333333333333333,</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    },</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    &quot;output&quot;: { &quot;chosenByWife&quot;: true }</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">  },</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">  {</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    &quot;input&quot;: {</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">      &quot;turn&quot;: 0.0001,</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">      &quot;columnIndex&quot;: 0.9,</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">      &quot;rowIndex&quot;: 0.6666666666666666,</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    },</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">    &quot;output&quot;: { &quot;chosenByWife&quot;: false }</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">  },</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">  ...</span></div><div class="token-line" style="color:rgba(0, 0, 0, 0.84)"><span class="token plain">];</span></div></div></pre><p>Сложность была с тем, чтобы угадать хорошие <strong><em>признаки для нейронной сети</em></strong> (номер хода, номер ячейки, размеры прямоугольника, количество свободных ячеек) и собрать <strong><em>тренировочный набор данных</em></strong> (5 игр и 2000 объектов <em>input/output</em> хватило). Также нужно было трансформировать все свои признаки в числа от 0 до 1, так как это требовал выбранный по умолчанию вид нейронной сети.</p><p>В итоге, каждый раз, когда бот выкидывал кубики, он находил все возможные для хода ячейки и размеры прямоугольника, и для каждого возможного хода вызывал функцию нейронной сети, чтобы узнать, какова вероятность того, что моя жена походила бы также. Ход с наибольшей вероятностью выбирался ботом и игра продолжалась.</p><p>Сейчас раз в 4 игры бот меня выигрывает.</p><p><img src="/9d1444001112a09a02d6bd00e0ace588/asset-10.gif"/></p><p><strong>Вывод.</strong> Встроенная функциональность <a href="https://boardgame.io/#/tutorial?id=adding-ai" target="_blank" rel="nofollow noopener noreferrer"><em>boardgame.io AI</em></a> еще сыра (май 2019). Однако, можно воспользоваться множеством различных подходов и библиотек для реализации своего собственного бота. Например, прекрасную для начинающих (по моему мнению) библиотеку <a href="https://github.com/BrainJS" target="_blank" rel="nofollow noopener noreferrer"><strong><em>brain.js</em></strong></a> с простой нейронной сетью, обученной учителем.</p><h3 id="заключение" style="position:relative"><a href="#%D0%B7%D0%B0%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D0%B5" aria-label="заключение permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Заключение</h3><p>На реализацию игры было потрачено около 2 месяцев безудержного веселья, примерно по 2–3 часа в день. Из этого примерно месяц ушел на реализацию оффлайн игры один на один (логика, пользовательский интерфейс, инфраструктура), чуть больше половины месяца на мультиплеер и чуть меньше половины месяца на бота. Уверен, что совершил бы значительно больше ошибок, если бы не фреймворк для игр <a href="https://boardgame.io" target="_blank" rel="nofollow noopener noreferrer"><strong><em>boardgame.io</em></strong></a>. Самыми сложными, по моему мнению, были реализация логики игры и бота. Неожиданно <strong>много времени</strong> заняли <strong><em>3d</em></strong> игральные кости, попытки <strong><em>drag-and-drop</em></strong>, развертывание сервера на <strong><em>heroku</em></strong><em>.</em> Неожиданно <strong>быстрым в реализации</strong> оказались обучение бота с помощью <strong><em>brain.js</em></strong>, комнаты (т.к. нашел почти готовый <strong><em>Lobby</em></strong>) и некоторые <strong>алгоритмы логики</strong> игры.</p><p>Много еще не сделано и предстоит сделать. Например, удобные комнаты, нормальная аутентификация, сохранение игры, чат… Так что, если вдруг у кого-нибудь будет желание что-нибудь сделать в проекте или поискать баги — прошу в <a href="https://github.com/lehaSVV2009/territories" target="_blank" rel="nofollow noopener noreferrer"><strong><em>github</em></strong></a>. Или пробуйте свое. Мне кажется, это принесет отличный и интересный опыт, который может пригодится в будущем!</p><p>P.S. Я далеко не профессионал в разработке игр и, скорее всего, совершил массу ошибок. Однако, это мой опыт. И, если он пригодится хотя бы кому-нибудь, это уже будет здорово.</p><h3 id="ссылки" style="position:relative"><a href="#%D1%81%D1%81%D1%8B%D0%BB%D0%BA%D0%B8" aria-label="ссылки permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Ссылки</h3><ol><li>Игра — <a href="https://lehasvv2009.github.io/territories/#/" target="_blank" rel="nofollow noopener noreferrer">https://lehasvv2009.github.io/territories</a></li><li>Репозиторий фронтенда — <a href="https://github.com/lehaSVV2009/territories" target="_blank" rel="nofollow noopener noreferrer">https://github.com/lehaSVV2009/territories</a></li><li>Репозиторий бэкенда— <a href="https://github.com/lehaSVV2009/territories-backend" target="_blank" rel="nofollow noopener noreferrer">https://github.com/lehaSVV2009/territories-backend</a></li><li>Репозиторий общих компонентов фронтенда и бэкенда — <a href="https://github.com/lehaSVV2009/territories-core" target="_blank" rel="nofollow noopener noreferrer">https://github.com/lehaSVV2009/territories-core</a>.</li><li>Документация фреймворка для игр — <a href="https://boardgame.io/" target="_blank" rel="nofollow noopener noreferrer">https://boardgame.io</a></li><li>3D-графика — <a href="https://threejs.org/" target="_blank" rel="nofollow noopener noreferrer">https://threejs.org</a></li><li>Material UI — <a href="https://material-ui.com/" target="_blank" rel="nofollow noopener noreferrer">https://material-ui.com</a></li><li>Хостинг сервера — <a href="https://heroku.com/" target="_blank" rel="nofollow noopener noreferrer">https://heroku.com/</a></li><li>Хостинг клиента — <a href="https://pages.github.com/" target="_blank" rel="nofollow noopener noreferrer">https://pages.github.com/</a></li><li>Сервис для сборки, тестирования и развертывания — <a href="https://travis-ci.org/" target="_blank" rel="nofollow noopener noreferrer">https://travis-ci.org/</a></li><li>Нейронные сети на JS — <a href="https://github.com/BrainJS/brain.js" target="_blank" rel="nofollow noopener noreferrer">https://github.com/BrainJS/brain.js</a></li><li>Монополия (дизайн 3D кубиков)—<a href="http://monopoly-club.org/" target="_blank" rel="nofollow noopener noreferrer">http://monopoly-club.org/</a></li><li>Мини-футбол (дизайн комнат) — <a href="https://www.haxball.com/" target="_blank" rel="nofollow noopener noreferrer">https://www.haxball.com/</a></li><li>Я — <a href="https://lehasvv2009.github.io/resume/" target="_blank" rel="nofollow noopener noreferrer">https://lehasvv2009.github.io/resume/</a></li></ol></article><style data-emotion-css="1b7yy3m">.css-1b7yy3m{margin-top:4em;text-align:left;}.css-1b7yy3m small{font-size:0.8em;opacity:0.7;}.css-1b7yy3m small a{font-size:17px;}</style><footer class="css-1b7yy3m"><style data-emotion-css="1562ncv">.css-1562ncv{float:right;-webkit-text-decoration:none;text-decoration:none;margin-top:0;}</style><a target="_blank" rel="nofollow noopener noreferrer" href="https://twitter.com/search?q=https://lehasvv2009.netlify.app/kakie-slozhnosti-pri-sozdanii-pervoj-nastolnoj-igry-na-javascript-(interfejs-multipleer-bot)/" class="css-1562ncv">♡<!-- --> <!-- -->Like</a><small><a target="_blank" rel="nofollow noopener noreferrer" href="https://twitter.com/search?q=https://lehasvv2009.netlify.app/kakie-slozhnosti-pri-sozdanii-pervoj-nastolnoj-igry-na-javascript-(interfejs-multipleer-bot)/">Discuss on Twitter</a> <!-- -->·<!-- --> <a target="_blank" rel="nofollow noopener noreferrer" href="https://github.com/lehaSVV2009/medium-blog/edit/master/content/kakie-slozhnosti-pri-sozdanii-pervoj-nastolnoj-igry-na-javascript-(interfejs-multipleer-bot)/index.md">Edit this post on GitHub</a></small><style data-emotion-css="18rsuz8">.css-18rsuz8{margin:24px 0;border:0;background:rgba(0,0,0,0.09);height:1px;}</style><hr class="css-18rsuz8"/><style data-emotion-css="6sb7k5">.css-6sb7k5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin-bottom:4.375rem;}</style><div class="css-6sb7k5"><style data-emotion-css="6p1krk">.css-6p1krk{margin-right:0.875rem;margin-bottom:0;min-width:50px;border-radius:100%;}</style><div class="css-6p1krk gatsby-image-wrapper" style="position:relative;overflow:hidden;display:inline-block;width:50px;height:50px"><img aria-hidden="true" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsSAAALEgHS3X78AAAFWUlEQVQ4yx2U61OUZRjG97+oZhoPSQYIJqdlWWCXZUHDFVPBXIRAQ0stzJxKayrNEQ1NRfEYh0mNrMkCRFZWcGFhgRVYENwTK6flfBAP1Ye+/brZD8/M+77PdV/PdV/X/byKpnu3abeamRzsYdTVgV/W0KNmJp84mB19zMKEh2dT3sB6MT0QeF8YdzE/5mRioIsxz0OmBDsidR5HMwpHuwVHeyNzUvxUgIvgxefZUSczw31C3IPfbae3uRpPZwPj3k6mh/qYGe1nbkyw/sdMDQlGcOO+HhTN9bexN9WxMOmlz1qFtbqC6eF+nk54mR3pZ8xpo/nPMmrKz1JVdoY20y35/lgInTyb9OF6aKbu1hX6Oy1MC17Rav4DW0MNL6Z8POm8R7upkqH+NlHrltNduNpqaamqoOmvn2n4owzTr9dk38aUqJ8bczPQfR/r3Zt02+qZWiTsaqkThSb+nhlk0t2Gta6SYaddPHIxI0p8nfU8sd/DUnUdm+k3GoTY96hVDnNKVwNC3kqzqH5kbwxYoOgR/xztDwLynwvA7xGPRvqYEE+eTw2IajOV549zpCCfO5U/YbfcYbC/Qzrw8FTws0I84u1idKCXObFJ0WU10d1aLwkOMuFqw9d1X0AuSVX86Wzig416dEGvoVvxCpmqUG6XF0sI/cxP+ITQx6izjd6WGoY93cyMeUSh7R5d1ru8nB3G32ehr7lKRqGbfxfG+GpXFie3JOA4tZeucwW0nd7Nj7lJuB8+4OX8KM9nhoTQhkMmwNtrE5tEoUPMtFvuSssDzA866LfWBkblibOTPF0M1QUZ9Jzeh//mERZqTlCer8H8Wxn/vZwOhDbm7sBuvo27uyXgucIpZnq6rUzKDI277Dhb6gM+9trMHDAkcm27noqcVOoOZFDziYHSfB13pO3FUIZlGoYl8T7p0NtjxddrRTHn98imVwZ6UG7BIH4x1+lopaOxll/2Z9F6dAeNB7fjOvc5478cpbUwlyF7A8+k3X/k5ryYcPNU0p0f9zLvd6O4/9cNdn2URmFhASUXjrKnwEhmdioffprDd59kUbpNxY1teqxf5GDen0LvzZNS6JHR6qKstISi08co/emcBGviemkxivzMtawMe5Vo9VJWxyxHpQshRhuCZkMM72at53hmApaD2TjP7OfXvalUCsH1krOcPvI5G7O3EmdYT6IhnYI9eRjS16HQpUahUgWRpA8hQReGPi2K+JRwUjLUGHMMFGZqOLkxlqvvazF9/R4H89/nYkkxFeXnKC4+zImT+9i5N4PtO9aTskmPQqtbRWTUcjS6N1EnBROfHIpmXSQqTSJRqyK4ul3Hjbxk2o4ZGbmyG23wG+QYjbQ0mblccY3zJacovVzIlfOfUST+KpRxy4iMWEaC9k3ihTQlLQJ1XDxhwbGsWBbCN+8oMRcYeHwih/Kda9GuWYM+NpbsNAPXLhVz6WYp3/54ivMXL1BZdnGRcAnKRYUJb5CcqiQ91YAhIYk1IWuIV+uIDw3GeiSXu4dziQ5aSVqKnuzNm1kbFcu21LV8nL+Lyupb1FhqKS67jCJes4yYiKXoNKtIUCWTrk1hX+YGQoPC+Orgl4SHRZOuVpGX9g5hb61mhzGHj3J3silZx4E8I+qwCA4d+pJbjSYsHY0ogoKXBAgT4yJZuSJcCNVkJGuJCI3mTOEPrE82kBipYqNOh1aZROaGDAp27UYfHcNe4yaiV63mvU1b+POBid/v16IwLl1JUmQwsRFKlrweJO0q2SKEyrfjKDr6PXq1nuTYBFLi1GiUGrYKYUlREXHhq8lal0RUWDipiUlUm+W/+egh/wN2QkxW7vfw2QAAAABJRU5ErkJggg==" alt="Alex Soroka" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms;border-radius:50%"/><noscript><picture><source srcset="/static/77b699ee4748cd19e9d9c97057b6dbfb/7260c/avatar.png 1x,
/static/77b699ee4748cd19e9d9c97057b6dbfb/6853d/avatar.png 1.5x,
/static/77b699ee4748cd19e9d9c97057b6dbfb/86348/avatar.png 2x" /><img loading="lazy" width="50" height="50" srcset="/static/77b699ee4748cd19e9d9c97057b6dbfb/7260c/avatar.png 1x,
/static/77b699ee4748cd19e9d9c97057b6dbfb/6853d/avatar.png 1.5x,
/static/77b699ee4748cd19e9d9c97057b6dbfb/86348/avatar.png 2x" src="/static/77b699ee4748cd19e9d9c97057b6dbfb/7260c/avatar.png" alt="Alex Soroka" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><p style="margin:0">Written by <strong>Alex Soroka</strong>.<!-- --> </p></div><hr class="css-18rsuz8"/><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li></li><li><a rel="next" href="/self-hosted-video-conference-for-friends-in-20-min/">Self-hosted video conference for friends in 20 min<!-- --> →</a></li></ul></footer></div></section></main></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/kakie-slozhnosti-pri-sozdanii-pervoj-nastolnoj-igry-na-javascript-(interfejs-multipleer-bot)/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-63ab9aa4b3aa6888c4ca.js"],"component---node-modules-gatsby-theme-medium-to-own-blog-src-pages-404-js":["/component---node-modules-gatsby-theme-medium-to-own-blog-src-pages-404-js-d4187d6d8820c0f2f6fa.js"],"component---node-modules-gatsby-theme-medium-to-own-blog-src-pages-index-js":["/component---node-modules-gatsby-theme-medium-to-own-blog-src-pages-index-js-0c5ad5ddf2b9a1234ff0.js"],"component---node-modules-gatsby-theme-medium-to-own-blog-src-templates-blog-post-js":["/component---node-modules-gatsby-theme-medium-to-own-blog-src-templates-blog-post-js-46f160a3f5c670133d66.js"]};/*]]>*/</script><script src="/component---node-modules-gatsby-theme-medium-to-own-blog-src-templates-blog-post-js-46f160a3f5c670133d66.js" async=""></script><script src="/e55b1624863f201557be7973b640ebc2d41868d9-cf9bb96bd1d6c958c6af.js" async=""></script><script src="/app-63ab9aa4b3aa6888c4ca.js" async=""></script><script src="/532a2f07-9b9ff0c8c1058b049d2c.js" async=""></script><script src="/styles-87377f8a4e3d033dcfd3.js" async=""></script><script src="/framework-20ef01989315425214b5.js" async=""></script><script src="/webpack-runtime-41b2cfaf8224fefc2537.js" async=""></script></body></html>